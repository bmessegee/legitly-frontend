<div class="wrapper">
    <!-- Business Name Lookup Section -->
    <div class="business-name-lookup" *ngIf="isLLCPackage()">
        <div class="lookup-header">
           
            <h3>Check Business Name Availability</h3>
            <p>Search to see if your desired business name is available in Washington State before completing your order.</p>
        </div>
        
        <div class="lookup-form">
            <mat-form-field appearance="outline" class="name-input">
                <mat-label>Enter your desired business name</mat-label>
                <input 
                    matInput 
                    [(ngModel)]="businessNameLookup" 
                    (input)="onBusinessNameLookupChange()"
                    placeholder="e.g., My Company LLC"
                    autocomplete="off">
                <mat-icon matSuffix *ngIf="isCheckingName">hourglass_empty</mat-icon>
                <mat-icon matSuffix *ngIf="!isCheckingName && businessNameLookup" color="primary">search</mat-icon>
            </mat-form-field>
            
            <button 
                mat-raised-button 
                color="primary" 
                (click)="checkBusinessName()"
                [disabled]="!businessNameLookup || businessNameLookup.trim().length === 0 || isCheckingName"
                class="check-button">
                <mat-icon>{{isCheckingName ? 'hourglass_empty' : 'search'}}</mat-icon>
                {{isCheckingName ? 'Checking...' : 'Check Availability'}}
            </button>
        </div>
        
        <!-- Results Section -->
        <div class="lookup-results" *ngIf="nameCheckResult">
            <div class="result-card" [ngClass]="nameCheckResult.isAvailable ? 'available' : 'unavailable'">
                <div class="result-icon">
                    <mat-icon>{{nameCheckResult.isAvailable ? 'check_circle' : 'cancel'}}</mat-icon>
                </div>
                <div class="result-content">
                    <h4>{{nameCheckResult.isAvailable ? 'Name Available!' : 'Name Unavailable'}}</h4>
                    <p *ngIf="nameCheckResult.isAvailable">
                        "{{nameCheckResult.businessName}}" is available for registration.
                    </p>
                    <p *ngIf="!nameCheckResult.isAvailable">
                        "{{nameCheckResult.businessName}}" is already registered. Please try a different name.
                    </p>
                    <div class="result-details" *ngIf="nameCheckResult.totalResults">
                        <small>Found {{nameCheckResult.existingBusinesses}} existing business(es) with similar names</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Name Check Error -->
        <div class="lookup-error" *ngIf="nameCheckError">
            <div class="error-card">
                <mat-icon color="warn">error</mat-icon>
                <div class="error-content">
                    <h4>Unable to Check Name</h4>
                    <p>{{nameCheckError}}</p>
                    <button mat-button color="primary" (click)="checkBusinessName()">Try Again</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Package Header Section -->
    <div class="package-header" *ngIf="formConfig">
        <div class="package-info">
            <div class="package-title">{{formConfig.title}}</div>
            <div class="package-subtitle" *ngIf="formConfig.subtitle">{{formConfig.subtitle}}</div>
            <div class="package-price">${{getServiceCost() | number:'1.0-0'}}</div>
            <div class="package-description">{{formConfig.instructions}}</div>
        </div>
        
        <!-- Package Features -->
        <div class="package-features" *ngIf="formConfig.features">
            <h4>What's Included:</h4>
            <ul class="features-list">
                <li *ngFor="let feature of formConfig.features" class="feature-item">
                    <mat-icon class="check-icon">check_circle</mat-icon>
                    <span>{{feature}}</span>
                </li>
            </ul>
        </div>

        <!-- Tier Comparison Button -->
        <div class="package-actions" *ngIf="isLLCPackage() && !isAddonService()">
            <button 
                mat-stroked-button 
                color="primary" 
                (click)="showComparison = !showComparison"
                class="compare-button">
                <mat-icon>compare_arrows</mat-icon>
                {{showComparison ? 'Hide' : 'Compare'}} Packages
            </button>
        </div>
    </div>

    <!-- Package Comparison Section -->
    <div class="package-comparison" *ngIf="showComparison && isLLCPackage()">
        <h3>Choose Your Package</h3>
        <div class="comparison-grid">
            <div class="package-card" 
                 *ngFor="let pkg of llcPackages" 
                 [class.selected]="selectedForm === pkg.id"
                 [class.popular]="pkg.popular"
                 (click)="switchPackage(pkg.id)">
                <div class="popular-badge" *ngIf="pkg.popular">Most Popular</div>
                <div class="package-card-header">
                    <h4>{{pkg.title}}</h4>
                    <div class="package-card-price">${{pkg.cost | number:'1.0-0'}}</div>
                    <p class="package-card-subtitle">{{pkg.subtitle}}</p>
                </div>
                <div class="package-card-features">
                    <ul>
                        <li *ngFor="let feature of pkg.features" class="package-feature">
                            <mat-icon class="mini-check">check</mat-icon>
                            <span>{{feature}}</span>
                        </li>
                    </ul>
                </div>
                <button 
                    mat-raised-button 
                    [color]="selectedForm === pkg.id ? 'primary' : ''"
                    [disabled]="selectedForm === pkg.id"
                    class="select-package-btn">
                    {{selectedForm === pkg.id ? 'Selected' : 'Select Package'}}
                </button>
            </div>
        </div>
    </div>

    <!-- Form Section for Packages (with form fields) -->
    <!-- Loading indicator -->
    <div class="loading-form" *ngIf="isLoadingOrder">
        <mat-icon class="loading-icon">hourglass_empty</mat-icon>
        <p>Loading your order...</p>
    </div>

    <div class="form-section" *ngIf="formConfig && isPackage() && !isLoadingOrder">
        <div class="form-header">
            <h3>Complete Your {{formConfig.title}}</h3>
            <p class="form-description">Please provide the following information for your service</p>
        </div>
        
        <form [formGroup]="form" (ngSubmit)="onCheckout()">
            <formly-form [form]="form" [fields]="fields" [model]="model"></formly-form>
            <div class="form-actions">
                <div class="checkout-summary">
                    <div class="summary-line">
                        <span>{{formConfig.title}}</span>
                        <span class="summary-price">${{getServiceCost() | number:'1.0-0'}}</span>
                    </div>
                    <div class="summary-total">
                        <span>Total</span>
                        <span class="total-price">${{getServiceCost() | number:'1.0-0'}}</span>
                    </div>
                </div>
                <button 
                    mat-raised-button 
                    color="primary" 
                    type="submit" 
                    [disabled]="!form.valid"
                    class="checkout-button">
                    <mat-icon>shopping_cart</mat-icon>
                    Checkout - ${{getServiceCost() | number:'1.0-0'}}
                </button>
            </div>
        </form>
    </div>

    <!-- Simple Add to Cart for Ala Carte Services (no form fields) -->
    <div class="ala-carte-section" *ngIf="formConfig && !isPackage()">
        <div class="ala-carte-actions">
            <div class="service-summary">
                <div class="summary-line">
                    <span>{{formConfig.title}}</span>
                    <span class="summary-price">${{formConfig.cost | number:'1.0-0'}}</span>
                </div>
                <div class="summary-description">{{formConfig.instructions}}</div>
            </div>
            <button 
                mat-raised-button 
                color="primary" 
                (click)="addToCart()"
                class="add-to-cart-button">
                <mat-icon>add_shopping_cart</mat-icon>
                Add to Cart - ${{formConfig.cost | number:'1.0-0'}}
            </button>
        </div>
    </div>
    
    <div *ngIf="!formConfig" class="loading-form">
        <mat-icon class="loading-icon">hourglass_empty</mat-icon>
        Loading package details...
    </div>
</div>
