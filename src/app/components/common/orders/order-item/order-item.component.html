<div class="common-card">
    <mat-icon class="common-card-icon">receipt</mat-icon>
    <div class="order-header">
        <h3 class="common-name">{{ order?.DisplayName || order?.OrderId}}</h3>
        <div class="status-indicator" [ngClass]="getStatusClass(order?.Status!)">
            <mat-icon>{{ getStatusIcon(order?.Status!) }}</mat-icon>
            <span>{{ getStatusLabel(order?.Status!) }}</span>
        </div>
    </div>
    <p class="common-meta">
        Ordered On: {{ order?.Created | date:'short' }}<br />
        Customer: {{ order?.CustomerDetails?.FirstName + " " +  order?.CustomerDetails?.LastName }}<br/>
        Total: ${{ order?.TotalAmount }}
    </p>
    
    <!-- Order Items Section - Always expanded -->
    <div class="order-items">
        <h4>Items:</h4>
        <div *ngFor="let item of order?.OrderItems; let i = index" class="order-item-detail">
            <div class="item-header">
                <span class="item-title">{{ item.FormTitle || item.ProductName }}</span>
                <span class="item-price">${{ item.Price }}</span>
            </div>
            <p class="item-summary" *ngIf="item.FormSummary">{{ item.FormSummary }}</p>
            
            <!-- Item actions directly visible -->
            <div class="item-actions">
                <!-- Customer actions -->
                <div *ngIf="!isTenantUser() && item.FormData">
                    <button mat-button color="primary" (click)="editOrderItem(i)">
                        <mat-icon>edit</mat-icon>
                        Edit Form
                    </button>
                </div>
                
                <!-- Tenant actions -->
                <div *ngIf="isTenantUser() && hasFormData(item)">
                    <button mat-button color="primary" (click)="viewFormDetails(i)">
                        <mat-icon>visibility</mat-icon>
                        View Form Details
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="order-actions">
        
        <!-- TENANT ACTIONS -->
        <ng-container *ngIf="isTenantUser()">
            <!-- Tenant can process submitted orders -->
            <button mat-button color="primary" (click)="startProcessing()" *ngIf="canTenantProcess()">
                <mat-icon>work</mat-icon>
                Start Processing
            </button>
            
            <!-- Tenant can complete processing orders -->
            <button mat-button color="accent" (click)="markCompleted()" *ngIf="canTenantComplete()">
                <mat-icon>check_circle</mat-icon>
                Mark Completed
            </button>
            
            
            <!-- Read-only for tenants when order is completed/rejected -->
            <span *ngIf="order?.Status === OrderStatus.Completed || order?.Status === OrderStatus.Rejected" class="readonly-indicator">
                <mat-icon>visibility</mat-icon>
                View Only
            </span>
        </ng-container>
        
        <!-- CUSTOMER ACTIONS -->
        <ng-container *ngIf="!isTenantUser()">
            <!-- In-progress orders (Created status) -->
            <ng-container *ngIf="isInProgress()">
                <button mat-button color="primary" (click)="continueOrder()">
                    <mat-icon>play_arrow</mat-icon>
                    Continue
                </button>
            </ng-container>
            
            <!-- Submitted orders (but not yet paid) -->
            <ng-container *ngIf="isSubmitted()">
                <button mat-button color="primary" (click)="editOrder()">
                    <mat-icon>edit</mat-icon>
                    Edit
                </button>
                <button mat-button color="accent" (click)="addToCart()">
                    <mat-icon>add_shopping_cart</mat-icon>
                    Add to Cart
                </button>
            </ng-container>
            
            <!-- Delete button for customers (Created or Submitted) -->
            <button mat-button color="warn" (click)="deleteOrder()" *ngIf="canDelete()">
                <mat-icon>delete</mat-icon>
                Delete
            </button>
            
            <!-- Read-only orders for customers (Processing, Completed, Rejected) -->
            <span *ngIf="isReadOnly()" class="readonly-indicator">
                <mat-icon>lock</mat-icon>
                Read Only
            </span>
        </ng-container>
    </div>
</div>